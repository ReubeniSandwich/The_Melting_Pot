<!doctype html> 
<html lang="en"> 
<head> 
    <meta charset="UTF-8" />
    <title>Making your first Phaser 3 Game - Part 2</title>
    <script src="//cdn.jsdelivr.net/npm/phaser@3.11.0/dist/phaser.js"></script>
    <style type="text/css">
        body {
            margin: 0;
        }
    </style>
</head>
<body>

<script type="text/javascript">

    var config = {
        type: Phaser.AUTO,
        width: 1000,
        height: 600,
        scene: {
            preload: preload,
            create: create,
            update: update
        },
        physics: {
        default: 'arcade',
        }
    };

    var text;
    var timedEvent;

    var game = new Phaser.Game(config);

    function preload ()
    {
        this.load.image("kitchenTop", "assets/MeltingPotStove_1.png");
        this.load.image("butterIngredient", "assets/MeltingPotButter.png");
        this.load.image("saltShaker", "assets/MeltingPotSalt.png");
        this.load.image("pepperShaker", "assets/MeltingPotPepper.png");
        this.load.image("pastaIngredient", "assets/MeltingPotNoodles.png");
        this.load.image("pastaCooked", "assets/MeltingPotNoodlesCooked.png");
        this.load.image("pan", "assets/pan.png");
        this.load.image("clover", "assets/clover.png")
    
        // this.load.image("", "assets/");

    }

    function create ()
    {
        this.initialTime = 150;

        text = this.add.text(32, 32, 'Timer: ' + formatTime(this.initialTime));

        timedEvent = this.time.addEvent({delay: 1000, callback: onEvent, callbackScope: this, loop: true});

        let self = this;
        var kitchenTop = this.add.image(0, 0, "kitchenTop").setScale(0.47, 0.4).setOrigin(0, 0);    
        var pan = this.add.image(900, 225, "pan").setInteractive({draggable: true});
        var pepper = this.add.image(0, 0, "pepperShaker").setInteractive().setOrigin(0, 0);
        var salt = this.add.image(50, 0, "saltShaker").setInteractive().setOrigin(0, 0);
        var pasta = this.add.image(50, 200, "pastaIngredient").setInteractive().setOrigin(0,0);
        var butter = this.add.image(0, 300, "butterIngredient").setInteractive().setOrigin(0,0);

        let cookZoneTopLeft = this.add.zone(500, 220, 100, 100).setRectangleDropZone(100, 100); //zone(x, y, width, height);
        let cookZoneTopRight = this.add.zone(700, 220, 100, 100).setRectangleDropZone(100, 100); //zone(x, y, width, height);
        let cookZoneBottomLeft = this.add.zone(500, 420, 100, 100).setRectangleDropZone(100, 100); //zone(x, y, width, height);
        let cookZoneBottomRight = this.add.zone(700, 420, 100, 100).setRectangleDropZone(100, 100); //zone(x, y, width, height);
       
        // cookZoneTopRight.input.dropZone = false;
        // cookZoneBottomLeft.input.dropZone = false;
        cookZoneBottomRight.input.dropZone = false;

        var graphics = this.add.graphics();
        graphics.lineStyle(6, 0xffff00);
        graphics.strokeRect(cookZoneTopLeft.x - cookZoneTopLeft.input.hitArea.width / 2, cookZoneTopLeft.y - cookZoneTopLeft.input.hitArea.height / 2, cookZoneBottomLeft.input.hitArea.width, cookZoneBottomLeft.input.hitArea.height);
        
       
        // Handles Simple Dragging of Objects

        // this.input.setDraggable(clover);
        // this.input.setDraggable(pan);
        


        // Object Dragging Logic
        this.input.on('dragstart', function (pointer, gameObject) {
            gameObject.setTint(0xff0000);
            self.children.bringToTop(gameObject);
        });

        this.input.on('drag', function (pointer, gameObject, dragX, dragY) {
            // Smooth movement
            // console.log (`X: ${dragX} | Y: ${dragY}`);
            gameObject.x = dragX;
            gameObject.y = dragY;
        });

        this.input.on('dragend', function (pointer, gameObject) {
            gameObject.clearTint();
        });

        this.input.on('dragenter', function (pointer, gameObject, dropZone) {
            console.log("drag enter");
            graphics.clear();
            graphics.lineStyle(6, 0x00ffff);
            graphics.strokeRect(cookZoneTopLeft.x - cookZoneTopLeft.input.hitArea.width / 2, cookZoneTopLeft.y - cookZoneTopLeft.input.hitArea.height / 2, cookZoneBottomLeft.input.hitArea.width, cookZoneBottomLeft.input.hitArea.height);
        });


        this.input.on('dragleave', function (pointer, gameObject, dropZone) {
            console.log("drag leave");
            
            graphics.clear();
            graphics.lineStyle(6, 0xffff00);
            graphics.strokeRect(cookZoneTopLeft.x - cookZoneTopLeft.input.hitArea.width / 2, cookZoneTopLeft.y - cookZoneTopLeft.input.hitArea.height / 2, cookZoneBottomLeft.input.hitArea.width, cookZoneBottomLeft.input.hitArea.height);
        });

        //handles if item is "dropped in dropzone"
        this.input.on('drop', function (pointer, gameObject, dropZone) {
            console.log("Item Dropped into DropZone");
            gameObject.x = dropZone.x
            gameObject.y = dropZone.y;
            
            //makes the object 'stuck'
            // gameObject.input.enabled = false;
});

    this.input.on('dragend', function (pointer, gameObject, dropped) {

        // Moves the object back if it was not put into drop zone
        if (!dropped)
        {
            gameObject.x = gameObject.input.dragStartX;
            gameObject.y = gameObject.input.dragStartY;
        }

        graphics.clear();
        graphics.lineStyle(6, 0xffff00);
        graphics.strokeRect(cookZoneTopLeft.x - cookZoneTopLeft.input.hitArea.width / 2, cookZoneTopLeft.y - cookZoneTopLeft.input.hitArea.height / 2, cookZoneBottomLeft.input.hitArea.width, cookZoneBottomLeft.input.hitArea.height);
    });

}

    function update ()
    {
    }

    function formatTime(seconds) {
        // Minutes
        var minutes = Math.floor(seconds/60);
        // Seconds
        var partInSeconds = seconds%60;
        // Adds left zeros to seconds
        partInSeconds = partInSeconds.toString().padStart(2,'0');
        // Returns formated time
        return `${minutes}:${partInSeconds}`;
    }

    function onEvent () {
        this.initialTime -= 1;
        text.setText('Timer: ' + formatTime(this.initialTime));
    }

</script>

</body>
</html>